# E14

## bien nommer ses variables

[commitstrip](https://www.commitstrip.com/fr/2016/01/18/what-idiot-wrote-this-code/?setLocale=1)

## Services

[doc](https://symfony.com/doc/5.4/service_container.html)

```yaml
services:
    # default configuration for services in *this* file
    _defaults:
        autowire: true      # Automatically injects dependencies in your services.
```

Pour voir les types utilisable en autowiring/injection de dÃ©pendances

```bash
bin/console debug:autowiring
```

Exemples:

* EntityManagerInterface
* RequestStack (remplace SessionInterface depuis 5.3)
* Request
* Tout les repository

Tout est 'services' dans le dossier 'src' sauf :

* tout le dossier `DependencyInjection`
* tout le dossier `Entity`
* le fichier `kernel.php`

```yaml
    # makes classes in src/ available to be used as services
    # this creates a service per class whose id is the fully-qualified class name
    App\:
        resource: '../src/'
        exclude:
            - '../src/DependencyInjection/'
            - '../src/Entity/'
            - '../src/Kernel.php'
```

## rÃ©cupÃ©ration des posters Ã  la crÃ©ation de film

pas de `make:service` ğŸ˜­

Il suffit juste de crÃ©er une classe, et de la demander en injection de dÃ©pendance ğŸ‰

Comment symfony va la retrouver : `autowiring: true` (en auto)

### crÃ©ation de la classe

rien de spÃ©cial, sauf ne pas se tromper pour le PSR-4

### utilisation du composant http-client

```bash
composer require symfony/http-client
```

### paramÃ©trage

on va modifier le fichier services.yaml

On y ajoute un paramÃ¨tre global

```yaml
# Put parameters here that don't need to change on each machine where the app is deployed
# https://symfony.com/doc/current/best_practices.html#use-parameters-for-application-configuration
# https://symfony.com/doc/current/configuration.html#configuration-parameters
parameters:
    # pour notre application, on crÃ©e un paramÃ¨tre GLOBAL Ã  tout l'application
    # celui ci sera disponible via le parameterBagInterface
    # qui est lui mÃªme un service ... donc on va en faire l'injection dans le constructeur
    app.omdbapi.apikey: "a93b767b"
```

on retrouve ce paramÃ¨tre dans un service : `ParameterBagInterface`

On a plus qu'a le demander via le constructeur

et utiliser la mÃ©thode get pour rÃ©cupÃ©rer la valeur

```php
public function __construct(ParameterBagInterface $globalParams)
{
    // je rÃ©cupÃ¨re le paramÃ¨tre de services.yaml que je veux
    $this->apiKey = $globalParams->get('app.omdbapi.apikey');
}
```
